# 时间堆定时器

使用小根堆实现定时器，添加和调整时间堆仅有主线程操作，删除操作采用延迟删除，可多线程使用，真实的删除操作有两种触发情况：

一、当插入新的时间堆定时器时，时间堆容量已满。

二、定时信号alarm触发。

具体删除操作：

+ 遍历执行过删除的定时器节点（通过一个vector保存）。
+ 将定时器的期望时间置为0，并执行上溯操作，使每一个删除的定时器都在堆顶附近。
+ 然后每次判断时间堆堆顶定时器的期望时间是否到达，到达则删除，直到堆顶定时器未到期或则没有任何节点。

缺点：

+ 定时器的多个操作是非线程安全的，仅能在主线程使用。

  